"use strict";class MdApi{baseUrl;lang;instId;async fetchJsonApi(e){e.searchParams.set("navlang",this.lang);const t=await fetch(e,{method:"GET",headers:{"X-VIA":"md api client; "+location.hostname}});if(!t.ok){const e=`An error has occured: ${t.status}`;throw new Error(e)}const n=await t.json();return Object.freeze(n),n}async getObject(e){const n=new URL(this.baseUrl+"/json/object/"+encodeURIComponent(e)),t=await this.fetchJsonApi(n);if(this.instId!==null&&t.object_institution.institution_id!==this.instId)throw"This object does not belong to the selected institution";return t}_getObjectSearchUrl(e,t,n=24,s=0){const o=new URL(this.baseUrl+e);if(typeof t=="object"?(o.searchParams.set("s",t.s),t.extend!==""&&o.searchParams.set("extendQuery",t.extend)):t.includes(":")?o.searchParams.set("s",t):o.searchParams.set("extendQuery",t),this.instId!==null&&o.searchParams.set("instnr",this.instId),s!==0&&o.searchParams.set("startwert",s),n>100)throw"You were trying to query more than the maximum 100 objects at a time";return o.searchParams.set("gbreitenat",n),o}async searchObjects(e,t=24,n=0){const s=this._getObjectSearchUrl("/json/objects",e,t,n),o=await this.fetchJsonApi(s);return o}async getObjectQueryStrings(e){const t=this._getObjectSearchUrl("/json/objects_get_query_string",e),n=await this.fetchJsonApi(t);return n.results}async getObjectsFacetSearchOptions(e){let t;typeof e=="object"||e.includes(":")===!1&&e!==""?t=await this.getObjectQueryStrings(e):(t=e,this.instId!==null&&(t+=" institution:"+this.instId));const n=new URL(this.baseUrl+"/json/object-facet-search/"+encodeURIComponent(t)),s=await this.fetchJsonApi(n);return s}async getObjectsFacetSearchOptionsFlat(e,t=20){const s=await this.getObjectsFacetSearchOptions(e),n=[];for(const e in s){if(this.instId!==null&&e==="institution")continue;for(const t of s[e])t.type=e,n.push(t)}n.sort((e,t)=>t.count-e.count);const o=n.slice(0,t);return o.sort((e,t)=>(""+e.name).localeCompare(t.name)),o}async getObjectsLinkedEntities(e){const t=new URL(this.baseUrl+"/json/search-linked-entries-by-name/"+encodeURIComponent(e)),n=await this.fetchJsonApi(t);return n}async getInstitution(e){const t=new URL(this.baseUrl+"/json/institution/"+encodeURIComponent(e)),n=await this.fetchJsonApi(t);return n}async listCollectionsByInst(e){const t=new URL(this.baseUrl+"/json/collections_by_institution/"+encodeURIComponent(e)),n=await this.fetchJsonApi(t);return n}async searchCollections(e,t=100,n=0){if(this.instId!==null)throw"You set an institution ID. Please use listCollectionsByInst()";const s=new URL(this.baseUrl+"/json/collections_by_institutions");s.searchParams.set("q",e),s.searchParams.set("limit",t),s.searchParams.set("offset",n);const o=await this.fetchJsonApi(s);return o}async getCollection(e){const t=new URL(this.baseUrl+"/json/collection/"+encodeURIComponent(e)),n=await this.fetchJsonApi(t);return n}async getSeries(e){const t=new URL(this.baseUrl+"/json/series/"+encodeURIComponent(e)),n=await this.fetchJsonApi(t);return n}async searchExhibition(e,t="start",n="DESC"){const s=new URL(this.baseUrl+"/json/list_exhibitions");this.instId!==null&&s.searchParams.set("institution_id",this.instId),e.start_before!==void 0&&e.start_before!==null&&s.searchParams.set("start_before",e.start_before.toString()),e.start_after!==void 0&&e.start_after!==null&&s.searchParams.set("start_after",e.start_after.toString()),e.end_before!==void 0&&e.end_before!==null&&s.searchParams.set("end_before",e.end_before.toString()),e.end_after!==void 0&&e.end_after!==null&&s.searchParams.set("end_after",e.end_after.toString()),e.permanent!==void 0&&e.permanent!==null&&s.searchParams.set("permanent",e.permanent),e.place!==void 0&&e.place!==null&&s.searchParams.set("place",e.place),s.searchParams.set("sort_by",t),s.searchParams.set("sort_order",n);const o=await this.fetchJsonApi(s);return o}async getExhibition(e){const t=new URL(this.baseUrl+"/json/exhibition/"+encodeURIComponent(e)),n=await this.fetchJsonApi(t);return n}async searchEvents(e,t="start",n="DESC"){const s=new URL(this.baseUrl+"/json/list_exhibitions");this.instId!==null&&s.searchParams.set("institution_id",this.instId),e.start_before!==void 0&&e.start_before!==null&&s.searchParams.set("start_before",e.start_before.toString()),e.start_after!==void 0&&e.start_after!==null&&s.searchParams.set("start_after",e.start_after.toString()),e.end_before!==void 0&&e.end_before!==null&&s.searchParams.set("end_before",e.end_before.toString()),e.end_after!==void 0&&e.end_after!==null&&s.searchParams.set("end_after",e.end_after.toString()),e.place!==void 0&&e.place!==null&&s.searchParams.set("place",e.place),s.searchParams.set("sort_by",t),s.searchParams.set("sort_order",n);const o=await this.fetchJsonApi(s);return o}async getEvent(e){const t=new URL(this.baseUrl+"/json/event/"+encodeURIComponent(e)),n=await this.fetchJsonApi(t);return n}setInstitutionId(e){this.instId=e}constructor(e,t){this.baseUrl=e,this.lang=t,this.instId=null}}"use strict";class MdEmbed{apiClient;assetsUrl;tls;_getDefaultTls(){return{search:"Search",reset_search:"Reset search",events:"Events",literature:"Literature",tags:"Tags",tag:"Tag",actor:"Actor",place:"Place",time:"Time",series:"Series",collection:"Collection",object_material_technique:"Material / Technique",object_dimensions:"Dimensions",inscription:"Inscription",comparable_objects:"Comparable objects",object_last_updated:"Last updated",objects_found:"Objects found",view_in_md:"View this entry on museum-digital"}}_genTextElem(e,t,n=""){const s=document.createElement(e);return s.textContent=t,n!==""&&s.classList.add(n),s}_genPreviewImg(e,t=null,n=null){const o=this.apiClient.baseUrl,s=document.createElement("img");return s.src=this.assetsUrl+"/"+e.replace("data",""),s.alt="",s.setAttribute("loading","lazy"),t!==null&&(s.width=t),n!==null&&(s.height=n),s.onerror=function(){console.log("Falling back to loading image from current domain"),s.src=o+"/"+e},s}_genPreviewImgLarge(e,t=null,n=null){const o=this.apiClient.baseUrl,s=document.createElement("img");return s.src=this.assetsUrl+"/"+e.replace("data","").replace("200w_","500w_"),s.alt="",s.setAttribute("loading","lazy"),t!==null&&(s.width=t),n!==null&&(s.height=n),s.onerror=function(){console.log("Falling back to loading image from current domain"),s.src=o+"/"+e.replace("500w_","200w_")},s}_genPagination(e,t,n,s){function a(t,s=""){const a=Math.floor(t/n)+1,i=new URL(window.location.toLocaleString());i.searchParams.set("offset",t);const o=document.createElement("a");return o.classList.add("md-pag"),o.textContent=a,o.href=i,s!==""&&o.setAttribute("rel",s),o.addEventListener("click",function(s){s.preventDefault(),e.dispatchEvent(new CustomEvent("md-pagination-triggered",{detail:{offset:t,limit:n}}))}),o}function c(){const e=document.createElement("span");return e.textContent="...",e}const i=s,l=t-n,o=document.createElement("div");o.classList.add("md-pagination"),i-n*2>0&&(o.appendChild(a(0,"1")),o.appendChild(c()));const d=[[i-n*2,""],[i-n*1,"prev"]];for(const e of d)e[0]>=0&&o.appendChild(a(e[0],e[1]));const r=document.createElement("span");r.classList.add("selected"),r.textContent=Math.floor(i/n)+1,o.appendChild(r);const u=[[i+n*1,"next"],[i+n*2,""]];for(const e of u)e[0]<t&&o.appendChild(a(e[0],e[1]));if(l>i+n*2){o.appendChild(c());const e=Math.ceil(n*Math.floor(t/n))-1;o.appendChild(a(e))}return o}_genTableRowLr(e,t){const n=document.createElement("tr");return n.appendChild(e),n.appendChild(t),n}_formatLiteratureEntry(e){console.log(e);const t=document.createElement("span");return t.classList.add("md-object-literature-entry"),e.literature_author!==""&&(t.appendChild(this._genTextElem("span",e.literature_author,"md-literature-author")),t.appendChild(document.createTextNode(". "))),e.literature_year!==""&&(t.appendChild(this._genTextElem("time",e.literature_year,"md-literature-year")),t.appendChild(document.createTextNode(". "))),e.literature_title!==""&&(t.appendChild(this._genTextElem("em",e.literature_title,"md-literature-title")),t.appendChild(document.createTextNode(". "))),e.literature_place_publisher!==""&&(t.appendChild(this._genTextElem("span",e.literature_place_publisher,"md-literature-place-publisher")),t.appendChild(document.createTextNode(". "))),e.literature_inlit!==""&&t.appendChild(this._genTextElem("span",": "+e.literature_inlit,"md-literature-inlit")),t}_formatEventEntry(e,t){console.log(t);const n=document.createElement("div");if(n.classList.add("md-object-event"),n.appendChild(this._genTextElem("span",t.event_type_name)),t.people!==void 0){const o=document.createElement("div");o.appendChild(this._genTextElem("span",this.tls.actor));const s=document.createElement("a");s.classList.add("md-ref-actor"),s.setAttribute("data-id",t.people.people_id),s.textContent=t.people.displayname,o.appendChild(s),n.appendChild(o),e.dispatchEvent(new CustomEvent("md-generated-ref-actor",{detail:{elem:s}}))}if(t.place!==void 0){const o=document.createElement("div");o.appendChild(this._genTextElem("span",this.tls.place));const s=document.createElement("a");s.classList.add("md-ref-place"),s.setAttribute("data-id",t.place.place_id),s.textContent=t.place.place_name,o.appendChild(s),n.appendChild(o),e.dispatchEvent(new CustomEvent("md-generated-ref-place",{detail:{elem:s}}))}if(t.time!==void 0){const o=document.createElement("div");o.appendChild(this._genTextElem("span",this.tls.time));const s=document.createElement("a");s.classList.add("md-ref-time"),s.setAttribute("data-id",t.time_id),s.textContent=t.time.time_name,o.appendChild(s),n.appendChild(o),e.dispatchEvent(new CustomEvent("md-generated-ref-time",{detail:{elem:s}}))}return n}_formatTagEntry(e,t){console.log(t);const n=document.createElement("a");return n.classList.add("md-object-ref-tag"),n.setAttribute("data-id",t.tag_id),n.textContent=t.tag_name,e.dispatchEvent(new CustomEvent("md-generated-ref-tag",{detail:{elem:n}})),n}_formatCollectionEntry(e,t){console.log(t);const n=document.createElement("a");return n.classList.add("md-object-ref-collection"),n.setAttribute("data-id",t.collection_id),n.textContent=t.collection_name,e.dispatchEvent(new CustomEvent("md-generated-ref-collection",{detail:{elem:n}})),n}_formatSeriesEntry(e,t){console.log(t);const n=document.createElement("a");return n.classList.add("md-object-ref-series"),n.setAttribute("data-id",t.series_id),n.textContent=t.series_name,e.dispatchEvent(new CustomEvent("md-generated-ref-series",{detail:{elem:n}})),n}_fillObjectResultsList(e,t,n=24,s=0){function o(t,n,s){n.classList.add("md-object-tile"),n.setAttribute("data-id",s.objekt_id);const o=t._genPreviewImg(s.image,200,Math.min(s.image_height,300));n.appendChild(o),n.appendChild(t._genTextElem("span",s.objekt_name,"md-object-name")),n.appendChild(t._genTextElem("span",s.objekt_inventarnr,"md-invno")),n.addEventListener("click",function(){e.dispatchEvent(new CustomEvent("md-ref-object-triggered",{detail:{id:s.objekt_id}}))})}this.apiClient.searchObjects(t,n,s).then(t=>{if(e.classList.remove("md-loading"),t.length===0)return e.textContent="There were no results for this query",!1;const r=[],i=document.createElement("div");i.classList.add("md-objects-result-meta"),i.appendChild(this._genTextElem("span",this.tls.objects_found+" "+t[0].total)),e.appendChild(i),t[0].total>n&&e.appendChild(this._genPagination(e,t[0].total,n,s));const a=document.createElement("div");a.classList.add("md-objects-result-list");for(const n of t){const e=document.createElement("a");o(this,e,n),r.push(e),a.appendChild(e)}e.appendChild(a),e.dispatchEvent(new CustomEvent("md-fully-loaded",{detail:{links:r}}))}).catch(t=>{e.classList.remove("md-loading"),e.textContent="Failed to load objects search results",console.error(t)})}_generateTypeaheadSearch(e,t,n){function o(e,t){const c=e.toLowerCase(),s=c.indexOf(t),o=t.length+s,n=document.createElement("span"),i=document.createElement("span");i.textContent=e.substring(0,s),n.appendChild(i);const a=document.createElement("mark");a.textContent=e.substring(s,o),n.appendChild(a);const r=document.createElement("span");return r.textContent=e.substring(o),n.appendChild(r),n}const i={};let s=document.getElementById("md-typeahead-list");if(e.form.valid===!1&&s!==void 0&&s!==null)return s.parentElem.removeChild(s),!1;for((s==null)&&(s=document.createElement("div"),s.id="md-typeahead-list",s.classList.add("md-typeahead-list"),s.style.position="absolute",s.style.top=e.offsetTop+e.offsetHeight+"px",s.style.left=e.offsetLeft+"px",s.style.minWidth=e.offsetWidth+"px",document.body.appendChild(s));s.firstChild;)s.removeChild(s.firstChild);for(const i of n.hits){const a=document.createElement("a");a.appendChild(o(i.name,t)),a.addEventListener("click",function(){console.log(e.form),e.form.dispatchEvent(new CustomEvent("md-typeahead-triggered",{detail:{type:i.type,id:i.id}}))}),s.appendChild(a)}}generateObjectResultsList(e,t=24,n=0){const s=document.createElement("div");s.classList.add("md-objects-result-wrap","md-loading"),this._fillObjectResultsList(s,e,t,n);const o=this;return s.addEventListener("md-pagination-triggered",function(n){for(;s.firstChild;)s.removeChild(s.firstChild);o._fillObjectResultsList(s,e,t,n.detail.offset)},{passive:!0}),s}generateFacetBubbles(e,t=20){const n=document.createElement("div");return n.classList.add("md-facet-bubbles-wrap","md-loading"),this.apiClient.getObjectsFacetSearchOptionsFlat(e,t).then(e=>{n.classList.remove("md-loading");const t=[];for(const o of e){const s=document.createElement("a");s.classList.add("md-facet-bubbles"),s.setAttribute("data-type",o.type),s.setAttribute("data-id",o.id),s.setAttribute("data-count",o.count),s.textContent=o.name,s.addEventListener("click",function(){n.dispatchEvent(new CustomEvent("md-facet-triggered",{detail:{type:o.type,id:o.id}}))}),t.push(s),n.appendChild(s)}n.dispatchEvent(new CustomEvent("md-fully-loaded",{detail:{links:t}}))}).catch(e=>{n.classList.remove("md-loading"),n.textContent="Failed to load facet data",console.error(e)}),n}generateObjectPreview(e){const t=document.createElement("div");return t.classList.add("md-object-preview","md-loading"),this.apiClient.getObject(e).then(e=>{t.classList.remove("md-loading"),console.log(e),t.setAttribute("data-id",e.object_id);for(const n of e.object_images)if(n.is_main==="j"){const s=this._genPreviewImg("data/"+e.md_subset+"/"+n.folder+"/"+n.preview);t.appendChild(s);break}t.appendChild(this._genTextElem("span",e.object_name,"md-object-name")),t.appendChild(this._genTextElem("span",e.object_inventory_number,"md-invno"));const n=new CustomEvent("md-fully-loaded");t.dispatchEvent(n)}).catch(e=>{t.classList.remove("md-loading"),t.textContent="Failed to load object data",console.error(e)}),t}generateObjectPage(e){const n=["object_material_technique","object_dimensions","inscription","comparable_objects"],t=document.createElement("div");return t.classList.add("md-object-page","md-loading"),this.apiClient.getObject(e).then(s=>{t.classList.remove("md-loading"),console.log(s),t.setAttribute("data-id",s.object_id),t.setAttribute("lang",s.expected_language);const c=document.createElement("div");c.classList.add("md-object-img-section");for(const e of s.object_images)if(e.is_main==="j"){const t=this._genPreviewImgLarge("data/"+s.md_subset+"/"+e.folder+"/"+e.preview);c.appendChild(t);break}t.appendChild(c),t.appendChild(this._genTextElem("h1",s.object_name,"md-object-name"));const i=document.createElement("div");i.classList.add("md-object-page-summary"),i.appendChild(this._genTextElem("span",s.object_inventory_number,"md-invno")),i.appendChild(this._genTextElem("span",s.object_type,"md-object-type")),t.appendChild(i);const a=document.createElement("div");a.classList.add("md-main-desc"),a.style.whiteSpace="pre-wrap",a.textContent=s.object_description,t.appendChild(a);const o=document.createElement("table");o.classList.add("md-object-details-table");for(const e of n){if(s[e]===void 0||s[e]==="")continue;o.appendChild(this._genTableRowLr(this._genTextElem("th",this.tls[e]),this._genTextElem("td",s[e])))}if(s.object_literature.length>0){const e=document.createElement("td");for(const t of s.object_literature)e.appendChild(this._formatLiteratureEntry(t));o.appendChild(this._genTableRowLr(this._genTextElem("th",this.tls.literature),e))}if(s.object_events.length>0){const e=document.createElement("td");for(const n of s.object_events)e.appendChild(this._formatEventEntry(t,n));o.appendChild(this._genTableRowLr(this._genTextElem("th",this.tls.events),e))}if(s.object_tags.length>0){const e=document.createElement("td");for(const n of s.object_tags)e.appendChild(this._formatTagEntry(t,n));o.appendChild(this._genTableRowLr(this._genTextElem("th",this.tls.tags),e))}if(s.object_collection.length>0){const e=document.createElement("td");for(const n of s.object_collection)e.appendChild(this._formatCollectionEntry(t,n));o.appendChild(this._genTableRowLr(this._genTextElem("th",this.tls.collection),e))}if(s.object_series.length>0){const e=document.createElement("td");for(const n of s.object_series)e.appendChild(this._formatSeriesEntry(t,n));o.appendChild(this._genTableRowLr(this._genTextElem("th",this.tls.series),e))}t.appendChild(o);const r=document.createElement("a");r.classList.add("md-link-to-entity-in-md"),r.href=this.apiClient.baseUrl+"/object/"+e,r.textContent=this.tls.view_in_md,t.appendChild(r),t.dispatchEvent(new CustomEvent("md-fully-loaded"))}).catch(e=>{t.classList.remove("md-loading"),t.textContent="Failed to load object data",console.error(e)}),t}generateSearchForm(e=!0){const n=document.createElement("form");n.classList.add("md-search-form");const t=document.createElement("input");t.type="search",t.classList.add("md-searchbar"),t.setAttribute("minlength","3"),t.placeholder=this.tls.search,n.appendChild(t);const o=document.createElement("button");if(o.classList.add("md-search-button"),o.type="submit",n.appendChild(o),e===!0){const e=this;(function(){const s={};t.addEventListener("keyup",function(){if(n.valid===!1)return e._generateTypeaheadSearch(t,"",{}),!1;const o=t.value;s[o]===void 0&&(s[o]=!1,e.apiClient.getObjectsLinkedEntities(o).then(n=>{s[o]=n,e._generateTypeaheadSearch(t,o,n)}).catch(e=>{console.error(e)})),typeof query=="object"&&e._generateTypeaheadSearch(t,o,s[o])})})()}n.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),n.dispatchEvent(new CustomEvent("md-object-search-submitted",{detail:{value:t.value}}))});const s=document.createElement("span");return s.classList.add("md-object-search-reset-span"),s.textContent=this.tls.reset_search,s.addEventListener("click",function(){n.dispatchEvent(new CustomEvent("md-object-search-reset"))}),n.appendChild(s),n}constructor(e,t=null,n={}){this.apiClient=e,t===null?this.assetsUrl="https://asset.museum-digital.org/":this.assetsUrl=t,this.tls=this._getDefaultTls();for(const e in n)this.tls[e]=n[e]}}